# 进程（Process）线程（Thread）协程（Coroutine）
[[toc]]

## 定义

进程、线程和协程是计算机程序设计中用于实现并发和并行执行的三种重要概念。

### 进程定义

进程是正在运行的**程序的实例**，是操作系统分配资源的基本单位，是一个独立的执行环境，包含了程序代码、数据和系统资源。每个进程都在自己的内存空间中运行，相互之间不会直接共享数据。

### 线程定义

线程是**进程的执行单元**，一个进程可以包含多个线程。线程共享进程的地址空间和系统资源，可以直接访问共享的数据，但也因此需要注意线程间的同步与互斥，以避免数据竞争。

### 协程定义

协程是**一种用户态的轻量级线程**，是一种轻量级的、用户态的并发编程概念，它在代码中可以被看作是一种特殊的函数，可以在代码执行过程中暂停和恢复。协程不受操作系统调度，由开发者手动控制调度，因此可以实现高效的任务切换。

## 特点

进程、线程和协程各自具有不同的特性和使用场景。

### 进程特点

* 资源独立：每个进程有独立的内存空间，资源互不干扰。
* 通信复杂：进程间通信比较复杂，需要通过管线、消息队列、共享内存等机制实现通信。
* 开销较大：创建和销毁进程需要较多的系统开销。

### 线程特点

* 进程内共享：多线程共享进程的空间和资源，但有独立的栈和寄存器。
* 通信高效：线程间可以直接共享进程的资源，进行数据交换和通信时更高效，需要共享变量和锁实现通信。
* 轻量级：相比于进程，线程创建和销毁的开销较小。

### 协程特点

* 线程内共享：协程在同一线程运行，共享线程内的资源。
* 通信非常高效：协程在同一线程内运行，可直接访问线程的共享内存。
* 调度方便：协程由用户显式调度，可以在执行过程中暂停，并在需要时恢复执行，无需操作系统参与。
* 低开销：协程的创建切换都不需要进行内核态和用户态之间的切换，开销小

## 异同

* 调度：进程和线程都是由操作系统管理的，而协程是由程序员手动控制调度。
* 资源：进程之间资源相互独立，线程可以共享进程的资源，而协程也可以在同一线程内共享数据。
* 通信：进程之间通信需要使用特定的进程间通信机制，线程间通信较为直接，而协程通信也可以通过共享数据进行。
* 开销：进程的创建和销毁开销较大，线程创建和销毁的开销相对较小，而协程更加轻量级。
* 适用场景：协程适合处理 I/O 密集型任务，而线程和进程适合处理计算密集型任务。

## 总结

* | 特性 | 进程 | 线程 | 协程 |
  | :---: | :---: | :---: | :---: |
  | 定义 | 拥有独立资源和空间的独立执行单位 | 共享进程资源的执行单元 | 用户态的轻量级线程 |
  | 开销 | 大 | 较小 | 最小 |
  | 共享 | 不共享 | 共享进程内存 | 共享线程内存 |
  | 通信 | 复杂（IPC） | 较简单 | 简单 |
  | 调度 | 操作系统内核调度 | 操作系统内核调度 | 用户显式调度 |
  | 适用场景 | 需要隔离保护不同模块的大型应用 | 多任务并发，高效通信任务 | 大量并发的任务，I/O密集型任务 |
* 由进程到线程再到协程，三者之间的通信和调度越来越简单方便、而计算能力越来越差，因此根据应用场景更需要计算，读写，还是通信来做选择

## 拓展

### Unity内是否支持多线程？

* Unity是支持多线程的，使用System.Threading类即可；
* Unity的对象和组件不支持多线程，需要在主线程调用；
* Unity的多线程可以用于执行A*寻路等计算型任务；
* 如果需要引用的对应的Unity对象可以使用协程实现；